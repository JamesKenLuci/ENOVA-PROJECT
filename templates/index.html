<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Planner Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>üóìÔ∏è Professional Event Manager</h1>

        <div class="header-nav">
            <p>Welcome, **{{ current_user.username }}** (Role: **{{ current_user.role.upper() }}**)</p>
            <a href="{{ url_for('logout') }}" class="logout-link">Log Out</a>
        </div>

        <!-- Flash messages display here -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        <!-- ADMIN ONLY: Event Creation Form -->
        {% if current_user.role == 'admin' %}
        <div class="form-section">
            <h2>Create a New Event</h2>
            <p>Use this form to schedule new events, set dates, and specify locations.</p>
            <form id="add-event-form" method="POST" action="{{ url_for('add_event') }}">
                <input type="text" name="title" placeholder="Event Title (e.g., Annual Sales Kickoff)" required>
                <div style="display: flex; gap: 15px;">
                    <input type="date" name="date" required style="flex: 1;">
                    <input type="time" name="time" style="flex: 1;">
                </div>
                <input type="text" name="location" placeholder="Location (e.g., Grand Ballroom, Online Webinar)" required>
                <textarea name="description" placeholder="Detailed Agenda or Key Notes (Optional)"></textarea>
                <button type="submit">Schedule Event</button>
            </form>
        </div>
        {% endif %}

        <!-- Event List (Visible to all logged-in users) -->
        <div class="events-section">
            <h2>Upcoming Scheduled Events</h2>
            <ul id="event-list">
                {% for event in events %}
                <li class="event-card">
                    <div class="event-details">
                        <p class="event-title">{{ event['title'] }}</p>
                        <p class="event-info">
                            <span style="font-weight: 600;">Date:</span> {{ event['date'] }} |
                            <span style="font-weight: 600;">Time:</span> {{ event['time'] or 'All Day' }}
                            <br><span style="font-weight: 600;">Location:</span> {{ event['location'] }}
                        </p>
                        {% if event['description'] %}
                            <p class="event-description">{{ event['description'] }}</p>
                        {% endif %}
                    </div>

                    <!-- ADMIN ONLY: Delete button -->
                    {% if current_user.role == 'admin' %}
                    <form method="POST" action="{{ url_for('delete_event', event_id=event['id']) }}" style="display:inline;">
                        <button type="submit" class="delete-btn">Delete</button>
                    </form>
                    {% endif %}
                </li>
                {% else %}
                <p>No events are currently scheduled. Administrators may add new events.</p>
                {% endfor %}
            </ul>
        </div>
    </div>
</body>
</html>