{% extends "base.html" %}

{% block title %}All Events{% endblock %}

{% block content %}

<section class="events-section">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
<h1 style="font-size: 1.8rem; font-weight: 700; color: #2c3e50;">
<i class="fas fa-bullhorn" style="margin-right: 10px; color: var(--primary-color);"></i>
Upcoming Events
</h1>

    <!-- Only allow Admins to create new events -->
    {% if current_user.is_authenticated and current_user.role == 'admin' %}
    <a href="{{ url_for('create_event') }}" class="button primary-btn" 
       style="width: auto; padding: 10px 20px; margin-top: 0; background-color: #2ECC71;">
        <i class="fas fa-plus-circle"></i> Create New Event
    </a>
    {% endif %}
</div>

<ul id="event-list">
    {% if events|length == 0 %}
    <!-- Displayed if the list of events is empty -->
    <li class="no-events-message">
        <i class="fas fa-box-open"></i>
        <p>No events have been scheduled yet. Check back soon!</p>
        {% if current_user.is_authenticated and current_user.role == 'admin' %}
        <p style="margin-top: 10px;">As an administrator, you can <a href="{{ url_for('create_event') }}" style="color: var(--primary-color); text-decoration: underline;">create the first one</a>.</p>
        {% endif %}
    </li>
    {% else %}
    <!-- Loop through each event object passed from the Flask view function -->
    {% for event in events %}
    <li class="event-card">
        <div>
            <!-- Link to the event detail page -->
            <a href="{{ url_for('event_detail', event_id=event.id) }}" class="event-title">
                {{ event.title }}
            </a>
            
            <p class="event-info">
                <i class="far fa-calendar-alt"></i> 
                {{ event.date.strftime('%B %d, %Y') }} at {{ event.time }}
            </p>
            
            <p class="event-info">
                <i class="fas fa-map-marker-alt"></i> 
                {{ event.location }}
            </p>

            <p class="event-description">
                {{ event.description|truncate(120) }}
            </p>
        </div>

        <!-- Admin Actions: Only displayed if the user is logged in AND is an 'admin' -->
        {% if current_user.is_authenticated and current_user.role == 'admin' %}
        <div class="admin-actions">
            <a href="{{ url_for('edit_event', event_id=event.id) }}" class="button edit-btn">
                <i class="fas fa-pencil-alt"></i> Edit
            </a>
            
            <!-- Delete form (using POST request for security) -->
            <form action="{{ url_for('delete_event', event_id=event.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete the event: {{ event.title }}? This action cannot be undone.');" style="flex: 1;">
                <button type="submit" class="button delete-btn">
                    <i class="fas fa-trash-alt"></i> Delete
                </button>
            </form>
        </div>
        {% endif %}
    </li>
    {% endfor %}
    {% endif %}
</ul>


</section>
{% endblock %}